{% extends 'home/home.html' %}
{% load static %}
{% load humanize %}
{% load custom_filters %}

{% block content %}
<div class="nava">
    <p onclick="window.location.href='{% url 'home' %}'" class="c">Trang chủ</p>
    <p>/</p>
    <p class="m" >Giỏ hàng</p>

</div>
<style>
    .m{
        color: rgba(0, 128, 0, 0.459);
    }
    .nava{
        display: flex;
        gap: 5px;
        margin-top: 20px;
        margin-left: 20px;

    }
    .nava .c{
        cursor: pointer;
    }

    .nava .c:hover{
        font-weight: bold;
        transform: scale(1.03);
        transition: 0.3s;
    }

</style>
<!-- Phiên bản mới nhất của jQuery -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<link rel="stylesheet" href="{% static 'home/css/cart.css' %}">

<!-- box message -->
{% if messages %}
{% for message in messages %}
<div class="alert alert-{{ message.tags }}">
    {{ message }}
</div>
{% endfor %}
{% endif %}
<!-- css cho message -->
<!-- scrip cho message xuất hiện 4 giây -->
<script>
    setTimeout(function () {
        document.querySelectorAll('.alert').forEach(function (alert) {
            alert.remove();
        });
    }, 4000);
</script>
<!-- end box message -->


<div class="chuagiohang">
    <!-- tiếp tục mua sắm -->
    <div class="tieude">
        <div class="cart-title-group">
            <h4 class="tdgh">Giỏ hàng của bạn hiện có ({{ total_items }} sản phẩm)</h4>
            <div class="select-all-container">
                
            </div>
        </div>
        <a href="{% url 'home' %}" class="btnvipro">Tiếp tục mua sắm</a>
    </div>
    <style>
        .cart-title-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .select-all-container {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .select-all-container input[type="checkbox"] {
            cursor: pointer;
        }
        
        .select-all-container label {
            cursor: pointer;
            font-size: 14px;
            color: #555;
        }
        .chuatc{
            display: flex;
            justify-content: start;
            gap: 5px;
            padding-left: 10px;
            align-items: center;
        }
        </style>
        
        <!-- JavaScript cho chức năng Select All -->
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            const selectAllCheckbox = document.getElementById('select-all');
            const itemCheckboxes = document.querySelectorAll('.cart-item .check-box');
            
            // Khi click vào checkbox "Chọn tất cả"
            selectAllCheckbox.addEventListener('change', function() {
                const isChecked = this.checked;
                
                // Cập nhật trạng thái tất cả các checkbox sản phẩm
                itemCheckboxes.forEach(checkbox => {
                    checkbox.checked = isChecked;
                });
                
                // Tính lại tổng tiền
                calculateTotal();
            });
            
            // Khi click vào checkbox của từng sản phẩm
            itemCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    // Kiểm tra xem tất cả checkbox sản phẩm có được chọn không
                    const allChecked = Array.from(itemCheckboxes).every(cb => cb.checked);
                    
                    // Cập nhật trạng thái checkbox "Chọn tất cả"
                    selectAllCheckbox.checked = allChecked;
                    
                    // Tính lại tổng tiền
                    calculateTotal();
                });
            });
            
            // Hàm tính tổng tiền dựa trên các sản phẩm được chọn
            function calculateTotal() {
                let total = 0;
                
                itemCheckboxes.forEach((checkbox, index) => {
                    if (checkbox.checked) {
                        // Lấy thẻ cha chứa thông tin sản phẩm
                        const cartItem = checkbox.closest('.cart-item');
                        
                        // Lấy giá trị tổng cộng của sản phẩm (cần xử lý chuỗi để chuyển về số)
                        const totalText = cartItem.querySelector('.total').textContent;
                        const totalValue = parseInt(totalText.replace(/[^\d]/g, ''));
                        
                        // Cộng vào tổng
                        total += totalValue;
                    }
                });
                
                // Hiển thị tổng tiền với định dạng VND
                const formattedTotal = new Intl.NumberFormat('vi-VN').format(total) + '₫';
                document.querySelector('.tongtien').textContent = formattedTotal;
            }
            
            // Khởi tạo tính toán tổng tiền ban đầu
            calculateTotal();
        });
        </script>
    <div class="cart-wrapper">


        <div class="cart-items">
            <div class="chuatc">
                <input type="checkbox" id="select-all" class="check-box">
                <label for="select-all">Chọn tất cả</label>
            </div>
            {% for item in cart_items %}
            <!-- một checkbox để chọn sản phẩm -->

            <div class="cart-item">
                <div class="lot">
                    <input type="checkbox" class="check-box">
                    <div class="product-info">
                        <img src="{{ item.image_url }}" alt="{{ item.product_name }}">
                        <div class="product-name">
                            <h3>{{ item.product_name }}</h3>
                            <span class="color-display">{{ item.color }}</span> | Size: {{ item.size }}</p>
                        </div>
                    </div>
                </div>
                <div class="quantity-control">
                    <form action="{% url 'update_cart' item.id %}" method="post">
                        {% csrf_token %}
                        <button type="button" class="btn-quantity" data-action="decrement">-</button>
                        <input type="number" class="so" name="quantity" value="{{ item.quantity }}" min="1">
                        <button type="button" class="btn-quantity" data-action="increment">+</button>
                        <button type="submit" class="btn-update">Cập nhật</button>
                    </form>
                </div>

                <div class="price-section">
                    <div class="chuagia">
                        <div class="gia">
                            <p class="lbgia">Đơn giá: </p>
                            <p class="price">{{ item.price|floatformat:0|intcomma }} ₫</p>
                        </div>
                        <div class="gia">
                            <p class="lbgia">Tổng cộng: </p>
                            <p class="total">{{ item.total|floatformat:0|intcomma }} ₫</p>
                        </div>


                    </div>
                    <i onclick="window.location.href='{% url 'remove_from_cart' item.id %}'" class="fas fa-trash"></i>
                </div>
            </div>
            {% empty %}
            <p class="empty-cart">Giỏ hàng trống</p>
            {% endfor %}
        </div>
        <style>
            .chuagia {
                display: flex;
                max-width: 200px; /* Set maximum width to 100px */
                overflow-x: auto; /* Enable horizontal scrolling */
                white-space: nowrap; /* Prevent text wrapping */
                gap: 15px; /* Space between pricing elements */
                padding: 5px 5px; /* Add some vertical padding */
                scrollbar-width: thin; /* For Firefox */
                
              }
              
              /* Customize scrollbar for webkit browsers */
              .chuagia::-webkit-scrollbar {
                height: 8px;
              }
              
              .chuagia::-webkit-scrollbar-track {
                background: #f1f1f1;
                border-radius: 10px;
              }
              
              .chuagia::-webkit-scrollbar-thumb {
                background: #888;
                border-radius: 10px;
              }
              
              .chuagia::-webkit-scrollbar-thumb:hover {
                background: #555;
              }
              
              .gia {
                display: flex;
                align-items: center;
                min-width: fit-content; /* Ensure content doesn't get squished */
              }
              
              .lbgia {
                font-weight: bold;
                margin-right: 5px;
              }
              
              .price, .total {
                font-weight: 500;
              }
        </style>

        <div class="cart-summary">
            <div class="total-price">
                <h4>TỔNG ĐƠN</h4>
                <span>Tổng tiền:</span>
                <span class="tongtien">0₫</span>
            </div>
            <button class="checkout-btn btnvip">TIẾN HÀNH THANH TOÁN</button>
        </div>
    </div>
</div>
<script>
    
</script>
<script src="{% static 'home/js/cart.js' %}"></script>
{% endblock %}